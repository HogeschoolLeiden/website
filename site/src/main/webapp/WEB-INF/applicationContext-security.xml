<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2011 Hippo

  Licensed under the Apache License, Version 2.0 (the  "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS"
  BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<beans
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:opensaml="http://www.surfnet.nl/schema/security/opensaml"
  xmlns:security="http://www.springframework.org/schema/security"
  xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns="http://www.springframework.org/schema/beans"

  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd http://www.surfnet.nl/schema/security/opensaml http://www.surfnet.nl/schema/security/spring-security-opensaml.xsd   http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd">


  <!--
  //############################################
  // START SAML SurfConext
  //############################################
  -->

  <bean id="propertyResolver" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location" value="${opensaml.conf}"/>
  </bean>

  <bean id="openSAMLDispatcherProperties" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="locations">
      <list>
        <value>${opensaml.conf}</value>
      </list>
    </property>
  </bean>
  
  <!-- TODO change provisioner-->
  <bean id="samlProvisioner" class="nl.hinttech.hsleiden.pi.security.SamlProvisioner"/>
  <!-- TODO change certificates -->
  <bean id="samlCertificateStore" class="nl.surfnet.spring.security.opensaml.KeyStore">
    <property name="certificates">
      <map> 
        <entry key="https://engine.surfconext.nl/authentication/idp/metadata" value="MIIDyzCCArOgAwIBAgIJAMzixtXMUH1NMA0GCSqGSIb3DQEBBQUAMHwxCzAJBgNVBAYTAk5MMRAwDgYDVQQIDAdVdHJlY2h0MRAwDgYDVQQHDAdVdHJlY2h0MRUwEwYDVQQKDAxTVVJGbmV0IEIuVi4xEzARBgNVBAsMClNVUkZjb25leHQxHTAbBgNVBAMMFGVuZ2luZS5zdXJmY29uZXh0Lm5sMB4XDTExMDEyNDEwMTg1N1oXDTIxMDEyMzEwMTg1N1owfDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxFTATBgNVBAoMDFNVUkZuZXQgQi5WLjETMBEGA1UECwwKU1VSRmNvbmV4dDEdMBsGA1UEAwwUZW5naW5lLnN1cmZjb25leHQubmwwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDMJ6v+f3owS3KR5IXSil+3XFwGvCVeYx3jDOFKAnwvXlDpTu+t730b8/spHtlopyJVAlb6qBIPN7R4TGTLqiu0zebYsYx/PtqCk5cbu9qs3h+p2BBoTXVwXA/ZYi0tqtxp04hcNrRj1TAgLyC0S+KASTF+zzccAcjTBid5EMioo+YllgSEobWJ4X33XVRqNrikAPDsNmDrdKUi257JSO2xhVIG5lbtmDaL5ORCD56oRmVdp7VQTEQ3Yass8J5Rn+Ub6WmRBYeG+KzFBvtyBput2o0/gvtJn9L+NWeDB0LyUPaUYG/X4GF14FcmFQfz7I5jBCNHtPcLJbPYbZKQNhz/AgMBAAGjUDBOMB0GA1UdDgQWBBS9QqP8gtMM6nm4oYzNbgqhEDP1aDAfBgNVHSMEGDAWgBS9QqP8gtMM6nm4oYzNbgqhEDP1aDAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQBH2qyYwLwesIOxUTj+NJ0VXRBDH8VecNLiUUs9Np4x8A0pxLvlNnv5TdJAruEg1LSVmAqqPUdAB2m7CKDeUVM9cwOB7vqelV2GNgOfevXi+DZRMffyyE8qyIcnTqvDOgcR8qGTPSVT+SIsOkV9bYrjltrbnal7cJermsA8SC5w/pjLaOHI1xIZHquZzymWoN3Zfz2CQg2r5o+AURYd74GrHhHqVa9VrdWtcimB+vTQQihoLt8YciehpJjOMpx2D66eFfpC8ix31RRdjAVIo1y33h1yU3gEHePDbOthZE+lpXi2WJqO85H85LqJOtgn2WPI3P2Tx32Cq1WXCYkxLaPI"/>
        <entry key="https://openidp.feide.no/simplesaml/saml2/idp/metadata.php" value="MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w=="/>
        <entry key="https://openidp.feide.no" value="MIICizCCAfQCCQCY8tKaMc0BMjANBgkqhkiG9w0BAQUFADCBiTELMAkGA1UEBhMCTk8xEjAQBgNVBAgTCVRyb25kaGVpbTEQMA4GA1UEChMHVU5JTkVUVDEOMAwGA1UECxMFRmVpZGUxGTAXBgNVBAMTEG9wZW5pZHAuZmVpZGUubm8xKTAnBgkqhkiG9w0BCQEWGmFuZHJlYXMuc29sYmVyZ0B1bmluZXR0Lm5vMB4XDTA4MDUwODA5MjI0OFoXDTM1MDkyMzA5MjI0OFowgYkxCzAJBgNVBAYTAk5PMRIwEAYDVQQIEwlUcm9uZGhlaW0xEDAOBgNVBAoTB1VOSU5FVFQxDjAMBgNVBAsTBUZlaWRlMRkwFwYDVQQDExBvcGVuaWRwLmZlaWRlLm5vMSkwJwYJKoZIhvcNAQkBFhphbmRyZWFzLnNvbGJlcmdAdW5pbmV0dC5ubzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAt8jLoqI1VTlxAZ2axiDIThWcAOXdu8KkVUWaN/SooO9O0QQ7KRUjSGKN9JK65AFRDXQkWPAu4HlnO4noYlFSLnYyDxI66LCr71x4lgFJjqLeAvB/GqBqFfIZ3YK/NrhnUqFwZu63nLrZjcUZxNaPjOOSRSDaXpv1kb5k3jOiSGECAwEAATANBgkqhkiG9w0BAQUFAAOBgQBQYj4cAafWaYfjBU2zi1ElwStIaJ5nyp/s/8B8SAPK2T79McMyccP3wSW13LHkmM1jwKe3ACFXBvqGQN0IbcH49hu0FKhYFM/GPDJcIHFBsiyMBXChpye9vBaTNEBCtU3KjjyG0hRT2mAQ9h+bkPmOvlEo/aH0xR68Z9hw4PF13w=="/>
        <entry key="https://idp.diy.surfconext.nl/simplesaml/saml2/idp/metadata.php" value="MIIE0zCCA7ugAwIBAgIJAMeqml0MvrPFMA0GCSqGSIb3DQEBBQUAMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmwwHhcNMTExMjA5MjM1ODM1WhcNMjExMjA4MjM1ODM1WjCBoTELMAkGA1UEBhMCTkwxEDAOBgNVBAgTB1V0cmVjaHQxEDAOBgNVBAcTB1V0cmVjaHQxEDAOBgNVBAoTB1NVUkZuZXQxEzARBgNVBAsTClNVUkZjb25leHQxGjAYBgNVBAMTEWRpeS5zdXJmY29uZXh0Lm5sMSswKQYJKoZIhvcNAQkBFhxzdXJmY29uZXh0LWJlaGVlckBzdXJmbmV0Lm5sMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwiRJ3ZjEnXb6aM7vjt/QZjsC+RH/TUoRxU4XB7jQSybI3jgBO3a4DFOEyyj29BhJdKB1zVbo3nUMgiWsFONUwMV4J1T4ANrcdzkWcJ+y7RCvUA7hK8C3y4CFBFuwVRZ1U03+MYJp5oerJxg3PrpjWj4AifKGQ5Er6BpmHsxUv7OnpXy007PIyFhm3c7WQdKWfPOanLmSaBglTs38+ET+/mKHKxPRmcfraMvepwf2b7u/9D7JvL0O9mW11NPxzDfhgf4T/axBsgU4EuRtneaY3QzWUYWZEfbYAconYWc+Zgv7VpcXsOZMvaoYZbfuJdLadblCI/sluYo5TY91Z76O6QIDAQABo4IBCjCCAQYwHQYDVR0OBBYEFHW4Pywn3PgnsNWrZDtaW35G2k9OMIHWBgNVHSMEgc4wgcuAFHW4Pywn3PgnsNWrZDtaW35G2k9OoYGnpIGkMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmyCCQDHqppdDL6zxTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQB10RA+Cnrbxth80ApR9h8gFj79O1NE8E2cUWeK8zyg+ElPM91bZdxP0DJgjBljbQaoTn78bktb0qGEBZ92Q1jNn3KQBiG/Y49QlirZIylywB/NRH8VJWO9HblkTmaTe4j1hfNMy9YjLF9xN/6N2drnyPM2qGeXHTPdaMILi4P1WVvwR0A9y8HySZyucuoQwGfyA6F0Q7UEBIwKQdJ7eH+1taiyTR3Rg3wkADL4lyT2I44R9D4TjTJ1175nhgAERZgOlSFHXQIfiRGSpCATPXzpoXl0ejGErvqDk36fQIGtafUM07liuRd0hhJ1vRSw3t/loHju8RUN9lqgnkagGR+M"/>
        <entry key="http://adfs.hsleiden.nl/adfs/services/trust" value="MIIE0zCCA7ugAwIBAgIJAMeqml0MvrPFMA0GCSqGSIb3DQEBBQUAMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmwwHhcNMTExMjA5MjM1ODM1WhcNMjExMjA4MjM1ODM1WjCBoTELMAkGA1UEBhMCTkwxEDAOBgNVBAgTB1V0cmVjaHQxEDAOBgNVBAcTB1V0cmVjaHQxEDAOBgNVBAoTB1NVUkZuZXQxEzARBgNVBAsTClNVUkZjb25leHQxGjAYBgNVBAMTEWRpeS5zdXJmY29uZXh0Lm5sMSswKQYJKoZIhvcNAQkBFhxzdXJmY29uZXh0LWJlaGVlckBzdXJmbmV0Lm5sMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwiRJ3ZjEnXb6aM7vjt/QZjsC+RH/TUoRxU4XB7jQSybI3jgBO3a4DFOEyyj29BhJdKB1zVbo3nUMgiWsFONUwMV4J1T4ANrcdzkWcJ+y7RCvUA7hK8C3y4CFBFuwVRZ1U03+MYJp5oerJxg3PrpjWj4AifKGQ5Er6BpmHsxUv7OnpXy007PIyFhm3c7WQdKWfPOanLmSaBglTs38+ET+/mKHKxPRmcfraMvepwf2b7u/9D7JvL0O9mW11NPxzDfhgf4T/axBsgU4EuRtneaY3QzWUYWZEfbYAconYWc+Zgv7VpcXsOZMvaoYZbfuJdLadblCI/sluYo5TY91Z76O6QIDAQABo4IBCjCCAQYwHQYDVR0OBBYEFHW4Pywn3PgnsNWrZDtaW35G2k9OMIHWBgNVHSMEgc4wgcuAFHW4Pywn3PgnsNWrZDtaW35G2k9OoYGnpIGkMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmyCCQDHqppdDL6zxTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQB10RA+Cnrbxth80ApR9h8gFj79O1NE8E2cUWeK8zyg+ElPM91bZdxP0DJgjBljbQaoTn78bktb0qGEBZ92Q1jNn3KQBiG/Y49QlirZIylywB/NRH8VJWO9HblkTmaTe4j1hfNMy9YjLF9xN/6N2drnyPM2qGeXHTPdaMILi4P1WVvwR0A9y8HySZyucuoQwGfyA6F0Q7UEBIwKQdJ7eH+1taiyTR3Rg3wkADL4lyT2I44R9D4TjTJ1175nhgAERZgOlSFHXQIfiRGSpCATPXzpoXl0ejGErvqDk36fQIGtafUM07liuRd0hhJ1vRSw3t/loHju8RUN9lqgnkagGR+M"/>
        <entry key="http://localhost:8080/site/OpenSAML.sso/Metadata" value="MIIE0zCCA7ugAwIBAgIJAMeqml0MvrPFMA0GCSqGSIb3DQEBBQUAMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmwwHhcNMTExMjA5MjM1ODM1WhcNMjExMjA4MjM1ODM1WjCBoTELMAkGA1UEBhMCTkwxEDAOBgNVBAgTB1V0cmVjaHQxEDAOBgNVBAcTB1V0cmVjaHQxEDAOBgNVBAoTB1NVUkZuZXQxEzARBgNVBAsTClNVUkZjb25leHQxGjAYBgNVBAMTEWRpeS5zdXJmY29uZXh0Lm5sMSswKQYJKoZIhvcNAQkBFhxzdXJmY29uZXh0LWJlaGVlckBzdXJmbmV0Lm5sMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwiRJ3ZjEnXb6aM7vjt/QZjsC+RH/TUoRxU4XB7jQSybI3jgBO3a4DFOEyyj29BhJdKB1zVbo3nUMgiWsFONUwMV4J1T4ANrcdzkWcJ+y7RCvUA7hK8C3y4CFBFuwVRZ1U03+MYJp5oerJxg3PrpjWj4AifKGQ5Er6BpmHsxUv7OnpXy007PIyFhm3c7WQdKWfPOanLmSaBglTs38+ET+/mKHKxPRmcfraMvepwf2b7u/9D7JvL0O9mW11NPxzDfhgf4T/axBsgU4EuRtneaY3QzWUYWZEfbYAconYWc+Zgv7VpcXsOZMvaoYZbfuJdLadblCI/sluYo5TY91Z76O6QIDAQABo4IBCjCCAQYwHQYDVR0OBBYEFHW4Pywn3PgnsNWrZDtaW35G2k9OMIHWBgNVHSMEgc4wgcuAFHW4Pywn3PgnsNWrZDtaW35G2k9OoYGnpIGkMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmyCCQDHqppdDL6zxTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQB10RA+Cnrbxth80ApR9h8gFj79O1NE8E2cUWeK8zyg+ElPM91bZdxP0DJgjBljbQaoTn78bktb0qGEBZ92Q1jNn3KQBiG/Y49QlirZIylywB/NRH8VJWO9HblkTmaTe4j1hfNMy9YjLF9xN/6N2drnyPM2qGeXHTPdaMILi4P1WVvwR0A9y8HySZyucuoQwGfyA6F0Q7UEBIwKQdJ7eH+1taiyTR3Rg3wkADL4lyT2I44R9D4TjTJ1175nhgAERZgOlSFHXQIfiRGSpCATPXzpoXl0ejGErvqDk36fQIGtafUM07liuRd0hhJ1vRSw3t/loHju8RUN9lqgnkagGR+M"/>
        <entry key="https://idp.diy.surfconext.nl/" value="MIIE0zCCA7ugAwIBAgIJAMeqml0MvrPFMA0GCSqGSIb3DQEBBQUAMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmwwHhcNMTExMjA5MjM1ODM1WhcNMjExMjA4MjM1ODM1WjCBoTELMAkGA1UEBhMCTkwxEDAOBgNVBAgTB1V0cmVjaHQxEDAOBgNVBAcTB1V0cmVjaHQxEDAOBgNVBAoTB1NVUkZuZXQxEzARBgNVBAsTClNVUkZjb25leHQxGjAYBgNVBAMTEWRpeS5zdXJmY29uZXh0Lm5sMSswKQYJKoZIhvcNAQkBFhxzdXJmY29uZXh0LWJlaGVlckBzdXJmbmV0Lm5sMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwiRJ3ZjEnXb6aM7vjt/QZjsC+RH/TUoRxU4XB7jQSybI3jgBO3a4DFOEyyj29BhJdKB1zVbo3nUMgiWsFONUwMV4J1T4ANrcdzkWcJ+y7RCvUA7hK8C3y4CFBFuwVRZ1U03+MYJp5oerJxg3PrpjWj4AifKGQ5Er6BpmHsxUv7OnpXy007PIyFhm3c7WQdKWfPOanLmSaBglTs38+ET+/mKHKxPRmcfraMvepwf2b7u/9D7JvL0O9mW11NPxzDfhgf4T/axBsgU4EuRtneaY3QzWUYWZEfbYAconYWc+Zgv7VpcXsOZMvaoYZbfuJdLadblCI/sluYo5TY91Z76O6QIDAQABo4IBCjCCAQYwHQYDVR0OBBYEFHW4Pywn3PgnsNWrZDtaW35G2k9OMIHWBgNVHSMEgc4wgcuAFHW4Pywn3PgnsNWrZDtaW35G2k9OoYGnpIGkMIGhMQswCQYDVQQGEwJOTDEQMA4GA1UECBMHVXRyZWNodDEQMA4GA1UEBxMHVXRyZWNodDEQMA4GA1UEChMHU1VSRm5ldDETMBEGA1UECxMKU1VSRmNvbmV4dDEaMBgGA1UEAxMRZGl5LnN1cmZjb25leHQubmwxKzApBgkqhkiG9w0BCQEWHHN1cmZjb25leHQtYmVoZWVyQHN1cmZuZXQubmyCCQDHqppdDL6zxTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQB10RA+Cnrbxth80ApR9h8gFj79O1NE8E2cUWeK8zyg+ElPM91bZdxP0DJgjBljbQaoTn78bktb0qGEBZ92Q1jNn3KQBiG/Y49QlirZIylywB/NRH8VJWO9HblkTmaTe4j1hfNMy9YjLF9xN/6N2drnyPM2qGeXHTPdaMILi4P1WVvwR0A9y8HySZyucuoQwGfyA6F0Q7UEBIwKQdJ7eH+1taiyTR3Rg3wkADL4lyT2I44R9D4TjTJ1175nhgAERZgOlSFHXQIfiRGSpCATPXzpoXl0ejGErvqDk36fQIGtafUM07liuRd0hhJ1vRSw3t/loHju8RUN9lqgnkagGR+M"/>
        <entry key="http://localhost:8090/" value="MIICHzCCAYgCCQD7KMJ17XQa7TANBgkqhkiG9w0BAQUFADBUMQswCQYDVQQGEwJOTDEQMA4GA1UECAwHVXRyZWNodDEQMA4GA1UEBwwHVXRyZWNodDEQMA4GA1UECgwHU3VyZm5ldDEPMA0GA1UECwwGQ29uZXh0MB4XDTEyMDMwODA4NTQyNFoXDTEzMDMwODA4NTQyNFowVDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxEDAOBgNVBAoMB1N1cmZuZXQxDzANBgNVBAsMBkNvbmV4dDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2slVe459WUDL4RXxJf5h5t5oUbPkPlFZ9lQysSoS3fnFTdCgzA6FzQzGRDcfRj0HnWBdA1YH+LxBjNcBIJ/nBc7Ssu4e4rMO3MSAV5Ouo3MaGgHqVq6dCD47f52b98df6QTAA3C+7sHqOdiQ0UDCAK0C+qP5LtTcmB8QrJhKmV8CAwEAATANBgkqhkiG9w0BAQUFAAOBgQCvPhO0aSbqX7g7IkR79IFVdJ/P7uSlYFtJ9cMxec85cYLmWL1aVgF5ZFFJqC25blyPJu2GRcSxoVwB3ae8sPCECWwqRQA4AHKIjiW5NgrAGYR++ssTOQR8mcAucEBfNaNdlJoy8GdZIhHZNkGlyHfY8kWS3OWkGzhWSsuRCLl78A=="/>
        <entry key="http://localhost:9090/" value="MIICHzCCAYgCCQD7KMJ17XQa7TANBgkqhkiG9w0BAQUFADBUMQswCQYDVQQGEwJOTDEQMA4GA1UECAwHVXRyZWNodDEQMA4GA1UEBwwHVXRyZWNodDEQMA4GA1UECgwHU3VyZm5ldDEPMA0GA1UECwwGQ29uZXh0MB4XDTEyMDMwODA4NTQyNFoXDTEzMDMwODA4NTQyNFowVDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxEDAOBgNVBAoMB1N1cmZuZXQxDzANBgNVBAsMBkNvbmV4dDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2slVe459WUDL4RXxJf5h5t5oUbPkPlFZ9lQysSoS3fnFTdCgzA6FzQzGRDcfRj0HnWBdA1YH+LxBjNcBIJ/nBc7Ssu4e4rMO3MSAV5Ouo3MaGgHqVq6dCD47f52b98df6QTAA3C+7sHqOdiQ0UDCAK0C+qP5LtTcmB8QrJhKmV8CAwEAATANBgkqhkiG9w0BAQUFAAOBgQCvPhO0aSbqX7g7IkR79IFVdJ/P7uSlYFtJ9cMxec85cYLmWL1aVgF5ZFFJqC25blyPJu2GRcSxoVwB3ae8sPCECWwqRQA4AHKIjiW5NgrAGYR++ssTOQR8mcAucEBfNaNdlJoy8GdZIhHZNkGlyHfY8kWS3OWkGzhWSsuRCLl78A=="/>
        <entry key="http://localhost:8080/" value="MIICHzCCAYgCCQD7KMJ17XQa7TANBgkqhkiG9w0BAQUFADBUMQswCQYDVQQGEwJOTDEQMA4GA1UECAwHVXRyZWNodDEQMA4GA1UEBwwHVXRyZWNodDEQMA4GA1UECgwHU3VyZm5ldDEPMA0GA1UECwwGQ29uZXh0MB4XDTEyMDMwODA4NTQyNFoXDTEzMDMwODA4NTQyNFowVDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxEDAOBgNVBAoMB1N1cmZuZXQxDzANBgNVBAsMBkNvbmV4dDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2slVe459WUDL4RXxJf5h5t5oUbPkPlFZ9lQysSoS3fnFTdCgzA6FzQzGRDcfRj0HnWBdA1YH+LxBjNcBIJ/nBc7Ssu4e4rMO3MSAV5Ouo3MaGgHqVq6dCD47f52b98df6QTAA3C+7sHqOdiQ0UDCAK0C+qP5LtTcmB8QrJhKmV8CAwEAATANBgkqhkiG9w0BAQUFAAOBgQCvPhO0aSbqX7g7IkR79IFVdJ/P7uSlYFtJ9cMxec85cYLmWL1aVgF5ZFFJqC25blyPJu2GRcSxoVwB3ae8sPCECWwqRQA4AHKIjiW5NgrAGYR++ssTOQR8mcAucEBfNaNdlJoy8GdZIhHZNkGlyHfY8kWS3OWkGzhWSsuRCLl78A=="/>
        <entry key="http://localhost:8080/site/OpenSAML.sso/Metadata" value="MIICHzCCAYgCCQD7KMJ17XQa7TANBgkqhkiG9w0BAQUFADBUMQswCQYDVQQGEwJOTDEQMA4GA1UECAwHVXRyZWNodDEQMA4GA1UEBwwHVXRyZWNodDEQMA4GA1UECgwHU3VyZm5ldDEPMA0GA1UECwwGQ29uZXh0MB4XDTEyMDMwODA4NTQyNFoXDTEzMDMwODA4NTQyNFowVDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxEDAOBgNVBAoMB1N1cmZuZXQxDzANBgNVBAsMBkNvbmV4dDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2slVe459WUDL4RXxJf5h5t5oUbPkPlFZ9lQysSoS3fnFTdCgzA6FzQzGRDcfRj0HnWBdA1YH+LxBjNcBIJ/nBc7Ssu4e4rMO3MSAV5Ouo3MaGgHqVq6dCD47f52b98df6QTAA3C+7sHqOdiQ0UDCAK0C+qP5LtTcmB8QrJhKmV8CAwEAATANBgkqhkiG9w0BAQUFAAOBgQCvPhO0aSbqX7g7IkR79IFVdJ/P7uSlYFtJ9cMxec85cYLmWL1aVgF5ZFFJqC25blyPJu2GRcSxoVwB3ae8sPCECWwqRQA4AHKIjiW5NgrAGYR++ssTOQR8mcAucEBfNaNdlJoy8GdZIhHZNkGlyHfY8kWS3OWkGzhWSsuRCLl78A=="/>
        <entry key="http://mock-sp" value="MIICHzCCAYgCCQD7KMJ17XQa7TANBgkqhkiG9w0BAQUFADBUMQswCQYDVQQGEwJOTDEQMA4GA1UECAwHVXRyZWNodDEQMA4GA1UEBwwHVXRyZWNodDEQMA4GA1UECgwHU3VyZm5ldDEPMA0GA1UECwwGQ29uZXh0MB4XDTEyMDMwODA4NTQyNFoXDTEzMDMwODA4NTQyNFowVDELMAkGA1UEBhMCTkwxEDAOBgNVBAgMB1V0cmVjaHQxEDAOBgNVBAcMB1V0cmVjaHQxEDAOBgNVBAoMB1N1cmZuZXQxDzANBgNVBAsMBkNvbmV4dDCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2slVe459WUDL4RXxJf5h5t5oUbPkPlFZ9lQysSoS3fnFTdCgzA6FzQzGRDcfRj0HnWBdA1YH+LxBjNcBIJ/nBc7Ssu4e4rMO3MSAV5Ouo3MaGgHqVq6dCD47f52b98df6QTAA3C+7sHqOdiQ0UDCAK0C+qP5LtTcmB8QrJhKmV8CAwEAATANBgkqhkiG9w0BAQUFAAOBgQCvPhO0aSbqX7g7IkR79IFVdJ/P7uSlYFtJ9cMxec85cYLmWL1aVgF5ZFFJqC25blyPJu2GRcSxoVwB3ae8sPCECWwqRQA4AHKIjiW5NgrAGYR++ssTOQR8mcAucEBfNaNdlJoy8GdZIhHZNkGlyHfY8kWS3OWkGzhWSsuRCLl78A=="/>
      </map>
    </property>
  </bean>

  <!--SERVICE PROVIDER-->

  <opensaml:service-provider id="samlAuthenticationProvider"
                             message-handler-ref="samlMessageHandler"
                             preauth-filter-ref="samlPreAuthFilter"
                             entity-id="${ISSUING_ENTITY_ID}"
                             assertion-consumer-uri="${ASSERTION_CONSUMER_URI}"
                             provisioner-ref="samlProvisioner"
                             certificatestore-ref="samlCertificateStore"
                             authentication-manager-ref="authenticationManager" />
                             
  <!--
    //############################################
    // END SAML SurfConext
    //############################################
  -->

  <!-- HTTP Security Configuration -->
  <security:http auto-config="true" use-expressions="true" disable-url-rewriting="true" entry-point-ref="loginUrlAuthenticationEntryPoint">

    <security:custom-filter position="PRE_AUTH_FILTER" ref="samlPreAuthFilter"/>

    <security:anonymous/>
    <!-- SAML resources -->
    <security:intercept-url pattern="/j_spring_security_logout" filters="none"/>
    <security:intercept-url pattern="/login.jsp" filters="none"/>
    <security:intercept-url pattern="/logout.jsp" filters="none"/>
    <security:intercept-url pattern="/OpenSAML.sso/**" access="permitAll"/>
    <security:intercept-url pattern="${ASSERTION_CONSUMER_URI}" access="hasAnyRole(ROLE_ANONYMOUS,ROLE_ADMIN,ROLE_USER)"/>

    <!-- exclude resources -->
    <security:intercept-url pattern="/favicon.ico" filters="none"/>
    <security:intercept-url pattern="/_rp/**" filters="none"/>
    <security:intercept-url pattern="/_cms/**" filters="none"/>
    <security:intercept-url pattern="/_cmsrest/**" filters="none"/>
    <security:intercept-url pattern="/_cmsinternal/**" filters="none"/>
    <security:intercept-url pattern="/ping/**" filters="none"/>
    <security:intercept-url pattern="/js/**" filters="none"/>
    <security:intercept-url pattern="/css/**" filters="none"/>
    <security:intercept-url pattern="/images/**" filters="none"/>
    <security:intercept-url pattern="/script/**" filters="none"/>
    
    <!--   <security:intercept-url pattern="/**" access="permitAll"/> -->
   <security:intercept-url pattern="${secure_pattern}" access="hasRole('ROLE_USER')" /> 

    <security:form-login login-page="/OpenSAML.sso/Login?target=${wayf.url.sso}" default-target-url="/"/>
    <security:anonymous/>
    <security:logout invalidate-session="true" logout-success-url="/logout.jsp" logout-url="/j_spring_security_logout"/>

    <security:remember-me/>
  </security:http>

 <bean id="loginUrlAuthenticationEntryPoint" class="org.onehippo.forge.security.support.springsecurity.authentication.login.HippoLoginUrlAuthenticationEntryPoint">
    <property name="loginFormUrl" value="/OpenSAML.sso/Login?target=${wayf.url.sso}"/>
  </bean>

  <!--  <security:http auto-config="false" entry-point-ref="loginUrlAuthenticationEntryPoint">
    &lt;!&ndash; Channel Manager &ndash;&gt;
    <security:intercept-url pattern="/_rp/**" filters="none"/>
    <security:intercept-url pattern="/_cmsrest/**" filters="none"/>
    <security:intercept-url pattern="/_cmsinternal/security*" filters="none"/>

    <security:intercept-url pattern="/css/**" filters="none"/>
    <security:intercept-url pattern="/images/**" filters="none"/>
    <security:intercept-url pattern="/binaries/**" filters="none"/>
    <security:intercept-url pattern="/login.jsp*" filters="none"/>
    <security:intercept-url pattern="/news/**" access="ROLE_everybody"/>

    <security:custom-filter position="LOGOUT_FILTER" ref="customLogoutFilter"/>
    <security:custom-filter position="REMEMBER_ME_FILTER" ref="customRememberMeFilter"/>
    <security:custom-filter position="FORM_LOGIN_FILTER" ref="customUsernamePasswordAuthenticationFilter"/>
  </security:http>-->


  <!--
    Channel Manager specification. Need to override the default filter.

    Custom Login Entry Point
  -->
<!--

 <bean id="loginUrlAuthenticationEntryPoint"
              class="org.onehippo.forge.security.support.springsecurity.authentication.login.HippoLoginUrlAuthenticationEntryPoint">
    <property name="loginFormUrl" value="/login.jsp"/>
  </bean>

  -->


  <!--
    Channel Manager specification. Need to override the default filter.

    Custom Form Login Filter
  -->
  <bean id="customUsernamePasswordAuthenticationFilter"
              class="org.onehippo.forge.security.support.springsecurity.authentication.HippoUsernamePasswordAuthenticationFilter">
    <property name="authenticationManager" ref="authenticationManager"/>
    <property name="authenticationFailureHandler" ref="failureHandler"/>
    <property name="authenticationSuccessHandler" ref="successHandler"/>
    <property name="rememberMeServices" ref="rememberMeServices"/>
  </bean>

  <bean id="successHandler"
              class="org.onehippo.forge.security.support.springsecurity.authentication.login.HippoSimpleUrlAuthenticationSuccessHandler">
    <property name="defaultTargetUrl" value="/"/>
  </bean>

  <bean id="failureHandler"
              class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
    <property name="defaultFailureUrl" value="/security?loginError=true"/>
  </bean>



  <security:authentication-manager alias="authenticationManager">
    <security:authentication-provider ref="samlAuthenticationProvider"/>
    <!-- Needed if you want the remember me feature-->
    <security:authentication-provider ref="hippoAuthenticationRememberMeProvider"/>
  </security:authentication-manager>



  <!--
    Hippo Repository based Authentication Remember Me Provider. This Authentication Provider support of remember me against Hippo Repository Security Store.
    If you don't need to use the remember me feature, you don't have to include the following bean.
  -->
  <bean id="hippoAuthenticationRememberMeProvider" class="org.onehippo.forge.security.support.springsecurity.authentication.rememberme.HippoAuthenticationRememberMeProvider">
    <property name="hippoUserDetailsService" ref="hippoUserServiceDetailsService"/>
    <property name="key" value="hipporemembermekey2012"/>
  </bean>

  <bean name="hippoUserServiceDetailsService" class="org.onehippo.forge.security.support.springsecurity.authentication.HippoUserDetailsServiceImpl">
    <property name="defaultRoleName" value="everybody"/>
  </bean>

  <bean id="customRememberMeFilter" class="org.springframework.security.web.authentication.rememberme.RememberMeAuthenticationFilter">
    <property name="rememberMeServices" ref="rememberMeServices"/>
    <property name="authenticationManager" ref="authenticationManager"/>
  </bean>


  <bean id="rememberMeServices" class="org.onehippo.forge.security.support.springsecurity.authentication.rememberme.HippoTokenBasedRememberMeServices">
    <property name="userDetailsService" ref="hippoUserServiceDetailsService"/>
    <property name="key" value="hipporemembermekey2012"/>
    <property name="tokenValiditySeconds" value="31536000"/>
  </bean>

  <!--
    Channel Manager specification. Need to override the default filter.

    Custom Logout Filter
  -->
  <bean id="customLogoutFilter" class="org.onehippo.forge.security.support.springsecurity.authentication.logout.HippoLogoutFilter">
    <!-- if logout succeed then this is the URL -->
    <constructor-arg ref="logoutSuccessHandler"/>
    <constructor-arg>
      <array>
        <ref bean="hippoLogoutHandler"/>
      </array>
    </constructor-arg>
    <property name="filterProcessesUrl" value="/j_spring_security_logout"/>
  </bean>

  <bean id="hippoLogoutHandler" class="org.onehippo.forge.security.support.springsecurity.authentication.logout.HippoSecurityContextLogoutHandler"/>

  <bean id="logoutSuccessHandler" class="org.onehippo.forge.security.support.springsecurity.authentication.logout.HippoLogoutSuccessHandler">
    <property name="defaultTargetUrl" value="/"/>
  </bean>
  <mvc:annotation-driven/>

  <!--  REPLACE BY HIPPO ONE-->
  <bean id="authnRequestController" class="nl.surfnet.spring.security.opensaml.controller.AuthnRequestController">
    <property name="SAMLMessageHandler" ref="samlMessageHandler"/>
    <property name="assertionConsumerServiceURL" value="${ASSERTION_CONSUMER_URL}"/>
    <property name="entityID" value="${ISSUING_ENTITY_ID}"/>
    <property name="credentialResolver" ref="samlKeyStoreCredentialResolverDelegate"/>
    <property name="metaDataProperties" value="metadata.properties"/>
  </bean>

  <bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="mappings">
      <value>
        /OpenSAML.sso/Login = authnRequestController
      </value>
    </property>
  </bean>

</beans>
